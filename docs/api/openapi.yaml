openapi: 3.0.3
info:
  title: Monarch Database API
  description: |
    High-performance, zero-dependency, in-memory database for JavaScript/TypeScript.
    Provides MongoDB-style queries, Redis-compatible data structures, vector search, and enterprise features.
  version: 1.0.0
  contact:
    name: Monarch Team
    url: https://monarch-db.dev
    email: support@monarch-db.dev
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:7331
    description: Local development server
  - url: https://api.monarch-db.dev
    description: Production server

tags:
  - name: Health
    description: Health check and monitoring endpoints
  - name: Collections
    description: Collection operations (CRUD)
  - name: Queries
    description: Query and search operations
  - name: Data Structures
    description: Redis-compatible data structures
  - name: Vector Search
    description: AI/ML vector search operations
  - name: Transactions
    description: Transaction management
  - name: Monitoring
    description: Performance monitoring and metrics

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Returns the health status of the service
      operationId: getHealth
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'
        '503':
          description: Service is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'

  /ready:
    get:
      tags:
        - Health
      summary: Readiness check
      description: Returns whether the service is ready to accept traffic
      operationId: getReadiness
      responses:
        '200':
          description: Service is ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReadinessStatus'
        '503':
          description: Service is not ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReadinessStatus'

  /live:
    get:
      tags:
        - Health
      summary: Liveness check
      description: Returns whether the service is alive
      operationId: getLiveness
      responses:
        '200':
          description: Service is alive
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LivenessStatus'

  /metrics:
    get:
      tags:
        - Monitoring
      summary: Prometheus metrics
      description: Returns metrics in Prometheus format
      operationId: getMetrics
      responses:
        '200':
          description: Metrics in Prometheus format
          content:
            text/plain:
              schema:
                type: string
                example: |
                  # HELP monarch_uptime_seconds Service uptime in seconds
                  # TYPE monarch_uptime_seconds gauge
                  monarch_uptime_seconds 3600.5

components:
  schemas:
    HealthStatus:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, unhealthy, degraded]
          description: Overall health status
        timestamp:
          type: string
          format: date-time
          description: Timestamp of the health check
        uptime:
          type: number
          description: Service uptime in milliseconds
        version:
          type: string
          description: Service version

    ReadinessStatus:
      type: object
      properties:
        ready:
          type: boolean
          description: Whether the service is ready to accept traffic
        checks:
          type: object
          properties:
            database:
              type: boolean
              description: Database connectivity check
            memory:
              type: boolean
              description: Memory availability check
            disk:
              type: boolean
              description: Disk availability check
        timestamp:
          type: string
          format: date-time
          description: Timestamp of the readiness check

    LivenessStatus:
      type: object
      properties:
        alive:
          type: boolean
          description: Whether the service is alive
        timestamp:
          type: string
          format: date-time
          description: Timestamp of the liveness check

    Document:
      type: object
      additionalProperties: true
      properties:
        _id:
          type: string
          description: Document ID

    Query:
      type: object
      additionalProperties: true
      description: MongoDB-style query object

    Error:
      type: object
      properties:
        error:
          type: string
          description: Error message
        code:
          type: string
          description: Error code
        details:
          type: object
          additionalProperties: true
          description: Additional error details

